
# Обработка ссылок с помощью VK

Этот скрипт позволяет работать с сокращёнными ссылками через API VK: проверять количество кликов по ссылке или сокращать ссылку. Он использует API ВКонтакте для получения статистики по сокращённым ссылкам и для их создания.

## Необходимые переменные окружения

Перед запуском скрипта создайте файл `.env` в корневой папке проекта и добавьте следующие настройки:

- **VK_TOKEN**  
  _Описание_: Токен доступа к VK API.  
  _Назначение_: Этот токен используется для аутентификации при обращении к методам API ВКонтакте (например, `utils.getShortLink` и `utils.getLinkStats`).  
  _Пример значения_: `abcdef1234567890abcdef1234567890`

> **Важно:** Токен должен быть выдан для вашего аккаунта, чтобы вы могли получать статистику по сокращённым ссылкам (если ссылка приватная, статистика доступна только владельцу токена).

### Где получить токен VK API?
Токен доступа можно получить в [VK API](https://vk.com/dev/access_token). 
1. Перейдите на страницу [Создание приложения VK](https://id.vk.com/about/business/go/).
2. Войдите в свой аккаунт, если вы еще не авторизованы.
3. Выберите **"Добавить приложение"**.
4. Выберите **Web**.
5. Заполните необходимые поля: название приложения, описание и URL сайта (если нужно).
6. Получите токен доступа, который будет использоваться для запросов к API.

Добавьте токен в файл `.env`:
```
VK_TOKEN=your_token_here
```

## Как установить

Убедитесь, что у вас установлен Python 3.

Установите зависимости с помощью команды:
```bash
pip install -r requirements.txt
```

Файл `requirements.txt` должен содержать:
```
requests==2.28.1
python-dotenv==0.21.0
```

Рекомендуется использовать [virtualenv/venv](https://docs.python.org/3/library/venv.html) для изоляции проекта.

## Как использовать

Скрипт принимает ссылку как аргумент командной строки. При запуске скрипта происходит следующее:
- Если ссылка уже является сокращённой (и доступна для вашего токена), скрипт запрашивает статистику и выводит количество кликов по ней.
- Если ссылка не является сокращённой, скрипт использует VK API для сокращения ссылки и выводит новую сокращённую ссылку.

### Примеры использования:

1. Для проверки статистики по сокращённой ссылке:
    ```bash
    python main.py "https://vk.cc/abc123"
    ```

2. Для получения новой сокращённой ссылки:
    ```bash
    python main.py "https://example.com"
    ```

## Описание функций

- **is_shorten_link(token: str, url: str) -> bool**  
  _Назначение_: Проверяет, является ли переданная ссылка сокращённой через VK API.  
  _Как работает_:  
  - Парсит URL и проверяет, что домен равен `vk.cc`.
  - Извлекает ключ из пути URL.
  - Выполняет запрос к методу `utils.getLinkStats` с указанными параметрами.
  - Если в ответе отсутствует поле `"error"` и присутствует поле `"response"`, возвращает `True`.

- **shorten_link(token: str, url: str) -> str**  
  _Назначение_: Создает сокращённую ссылку через VK API.  
  _Как работает_:  
  - Отправляет запрос к методу `utils.getShortLink` с переданной ссылкой.
  - Если API возвращает сокращённую ссылку (поле `"response"`), возвращает её.
  - В случае ошибки выбрасывает исключение с сообщением об ошибке.

- **count_clicks(token: str, short_url: str) -> int**  
  _Назначение_: Возвращает количество кликов по сокращённой ссылке.  
  _Как работает_:  
  - Извлекает ключ из сокращённой ссылки.
  - Выполняет запрос к методу `utils.getLinkStats`.
  - Если в ответе присутствуют данные статистики, возвращает количество кликов.
  - В случае ошибки выбрасывает исключение с сообщением об ошибке.

- **main()**  
  _Назначение_: Основная функция, управляющая логикой работы скрипта.  
  _Как работает_:  
  - Загружает переменные окружения из файла `.env`.
  - Получает ссылку для проверки или сокращения через аргументы командной строки (с использованием `argparse`).
  - Если ссылка сокращена, выводит количество кликов.
  - Если ссылка не сокращена, создает сокращённую ссылку и выводит её.

## Цель проекта

Этот проект создан для маркетологов, которые хотят автоматизировать работу с сокращёнными ссылками через VK API. Скрипт позволяет получать статистику по кликам на сокращённые ссылки, а также автоматически сокращать длинные ссылки. Код написан в образовательных целях на онлайн-курсе для веб-разработчиков [dvmn.org](https://dvmn.org/).

